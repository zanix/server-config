#!/bin/env bash
# Creates a rdiff-backup for various system settings.
# See /etc/cron.d/backup

SOURCE="/"
DEST="${1:-/backup/system}"
KEEP="${2:-30D}"
INCLUDE="${3:-}"

# Create directory
mkdir -p ${DEST}

rdiff-backup --api-version 201 backup \
  --include '/etc' \
  --include '/root' \
  --include '/home' \
  --include '/usr/local/*bin' \
  ${INCLUDE} \
  --exclude '/*' \
  ${SOURCE} \
  ${DEST}/

rdiff-backup --api-version 201 remove increments --older-than ${KEEP} ${DEST}/
